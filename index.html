<!DOCTYPE html>
<html>
  <head>
    <title>Vega-Lite Bar Chart</title>
    <meta charset="utf-8" />

    <script src="https://cdn.jsdelivr.net/npm/vega@5.16.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.16.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.12.2"></script>

    <style media="screen">
      /* Add space between Vega-Embed links  */
      .vega-actions a {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <!-- Container for the visualization -->
    <div id="vis"></div>

    <script>
      // Assign the specification to a local variable vlSpec.
      var vlSpec = {
		  "$schema": "https://vega.github.io/schema/vega/v4.json",
		  "width": 800,
		  "height": 500,
		  "config": {
			"background": "#0f163b"
		  },
		  "autosize": "none",

		  "signals": [
			{ "name": "tx", "update": "width / 2" },
			{ "name": "ty", "update": "height / 2" },
			{
			  "name": "scale",
			  "value": 150,
			  "on": [{
				"events": {"type": "wheel", "consume": true},
				"update": "clamp(scale * pow(1.0005, -event.deltaY * pow(16, event.deltaMode)), 150, 3000)"
			  }]
			},
			{
			  "name": "angles",
			  "value": [0, 0],
			  "on": [{
				"events": "mousedown",
				"update": "[rotateX, centerY]"
			  }]
			},
			{
			  "name": "cloned",
			  "value": null,
			  "on": [{
				"events": "mousedown",
				"update": "copy('projection')"
			  }]
			},
			{
			  "name": "start",
			  "value": null,
			  "on": [{
				"events": "mousedown",
				"update": "invert(cloned, xy())"
			  }]
			},
			{
			  "name": "drag", "value": null,
			  "on": [{
				"events": "[mousedown, window:mouseup] > window:mousemove",
				"update": "invert(cloned, xy())"
			  }]
			},
			{
			  "name": "delta", "value": null,
			  "on": [{
				"events": {"signal": "drag"},
				"update": "[drag[0] - start[0], start[1] - drag[1]]"
			  }]
			},
			{
			  "name": "rotateX", "value": 0,
			  "on": [{
				"events": {"signal": "delta"},
				"update": "angles[0] + delta[0]"
			  }]
			},
			{
			  "name": "centerY", "value": 0,
			  "on": [{
				"events": {"signal": "delta"},
				"update": "clamp(angles[1] + delta[1], -60, 60)"
			  }]
			}
		  ],

		  "projections": [
			{
			  "name": "projection",
			  "type": "equirectangular",
			  "scale": {"signal": "scale"},
			  "rotate": [{"signal": "rotateX"}, 0, 0],
			  "center": [0, {"signal": "centerY"}],
			  "translate": [{"signal": "tx"}, {"signal": "ty"}]
			}
		  ],

		  "data": [
			{
			  "name": "dataset",
			  "url": "https://raw.githubusercontent.com/jreq0001/jreq0001.github.io/main/data/co2_per_capita.csv",
			  "format": {
				"type": "csv"
			  }
			},
			{
			  "name": "world",
			  "url": "https://raw.githubusercontent.com/jreq0001/jreq0001.github.io/main/data/worldmap.json",
			  "format": {
				"type": "topojson",
				"feature": "new"
			  },
			  "transform": [{
				"type": "lookup",
				"from": "dataset",
				"key": "iso_n3",
				"fields": ["id"],
				"values": ["delta", "1995", "2005", "2014"],
				"as": ["change", "1995", "2005", "2014"],
				"default": "null"
			  }]
			},
			{
			  "name": "graticule",
			  "transform": [
				{ "type": "graticule", "step": [15, 15] }
			  ]
			}
		  ],
			"scales": [
			{
			  "name": "color",
			  "type": "linear",
			  "domain": [-5, 5],
			  "range": {"scheme": "lightmulti", "count": 20}
			}
		  ],
		  "marks": [
			{
			  "type": "shape",
			  "from": {"data": "world"},
			  "encode": {
				  "update": { 
					"strokeWidth": {"value": 0.5},
					"stroke": {"value": "white"},
					"fill": [
					  {
						"test": "datum['change'] != 'null'",
						"scale": "color", 
						"field": "change"
					  },
					  {
						"value": "#bdbdbd"
					  }
					],
					"fillOpacity": { "value": 0.8 }
				  },
				  "hover": {
					"strokeWidth": {"signal": " + 1.5"},
					"stroke": {"value": "black"},
					"zindex": {"value": 1},
					"fillOpacity": { "value": 1 }
				  }
			  },
			  "transform": [
				{ "type": "geoshape", "projection": "projection" }
			  ]
			}
		  ]
		}// Embed the visualization in the container with id `vis`
      vegaEmbed('#vis', vlSpec);
    </script>
  </body>
</html>